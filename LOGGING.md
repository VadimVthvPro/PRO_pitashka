# üìä –°–∏—Å—Ç–µ–º–∞ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è PROpitashka

## –û–±–∑–æ—Ä

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∑–∞–ø–∏—Å—å—é –≤ —Ñ–∞–π–ª—ã –∏ PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞, –Ω–∞—Ö–æ–¥–∏—Ç—å –æ—à–∏–±–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

### –§–∞–π–ª–æ–≤—ã–µ –ª–æ–≥–∏

–õ–æ–≥–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `PROpitashka/logs/`:

- **`bot_all.log`** - –í—Å–µ –ª–æ–≥–∏ (DEBUG –∏ –≤—ã—à–µ)
  - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10 –ú–ë
  - –•—Ä–∞–Ω–∏—Ç—Å—è 10 —Ä–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
  - –ü–æ–¥—Ä–æ–±–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –Ω–æ–º–µ—Ä–∞–º–∏ —Å—Ç—Ä–æ–∫

- **`bot_errors.log`** - –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏ (ERROR –∏ –≤—ã—à–µ)
  - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5 –ú–ë
  - –•—Ä–∞–Ω–∏—Ç—Å—è 10 —Ä–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
  - –í–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–Ω—ã–µ —Ç—Ä–µ–π—Å–±–µ–∫–∏ –æ—à–∏–±–æ–∫

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `bot_logs` –≤ PostgreSQL:

```sql
CREATE TABLE bot_logs (
    id SERIAL PRIMARY KEY,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    level VARCHAR(10),                    -- –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∞ (INFO, ERROR –∏ —Ç.–¥.)
    logger_name VARCHAR(100),             -- –ò–º—è –ª–æ–≥–≥–µ—Ä–∞
    message TEXT,                         -- –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
    user_id BIGINT,                       -- ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
    username VARCHAR(100),                -- Username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function_name VARCHAR(100),           -- –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏
    line_number INTEGER,                  -- –ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –≤ –∫–æ–¥–µ
    error_traceback TEXT                  -- –ü–æ–ª–Ω—ã–π —Ç—Ä–µ–π—Å–±–µ–∫ –æ—à–∏–±–∫–∏
);
```

## üìù –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### DEBUG
–ü–æ–¥—Ä–æ–±–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–ª—É–±–æ–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.

**–ü—Ä–∏–º–µ—Ä:**
```python
logger.debug("–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {data}")
```

### INFO
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã. –ö–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è.

**–ü—Ä–∏–º–µ—Ä:**
```python
log_user_action(logger, user, "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞", "–í–µ—Å: 70–∫–≥")
```

### WARNING
–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö.

**–ü—Ä–∏–º–µ—Ä:**
```python
logger.warning(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} - –Ω–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ")
```

### ERROR
–û—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø—Ä–∏–≤–µ–ª–∏ –∫ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞.

**–ü—Ä–∏–º–µ—Ä:**
```python
log_error(logger, user, exception, "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö")
```

### CRITICAL
–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è.

**–ü—Ä–∏–º–µ—Ä:**
```python
logger.critical("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö")
```

## üîç –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ SSH

```bash
# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh user@your-server.com

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –±–æ—Ç–∞
cd /path/to/PROpitashka/PROpitashka

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ª–æ–≥–æ–≤
tail -f logs/bot_all.log

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫
tail -f logs/bot_errors.log

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
tail -n 100 logs/bot_all.log

# –ü–æ–∏—Å–∫ –ø–æ –ª–æ–≥–∞–º
grep "–û—à–∏–±–∫–∞" logs/bot_all.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
grep "user_id: 123456" logs/bot_errors.log
```

### –ò–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 –ª–æ–≥–æ–≤
SELECT * FROM bot_logs 
ORDER BY timestamp DESC 
LIMIT 50;

-- –í—Å–µ –æ—à–∏–±–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å
SELECT * FROM bot_logs 
WHERE level IN ('ERROR', 'CRITICAL') 
  AND timestamp > NOW() - INTERVAL '1 day'
ORDER BY timestamp DESC;

-- –î–µ–π—Å—Ç–≤–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT timestamp, level, message 
FROM bot_logs 
WHERE user_id = 123456
ORDER BY timestamp DESC;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ —Ñ—É–Ω–∫—Ü–∏—è–º
SELECT function_name, COUNT(*) as error_count
FROM bot_logs
WHERE level = 'ERROR'
GROUP BY function_name
ORDER BY error_count DESC;

-- –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ —Å —Ç—Ä–µ–π—Å–±–µ–∫–æ–º
SELECT timestamp, message, error_traceback
FROM bot_logs
WHERE error_traceback IS NOT NULL
ORDER BY timestamp DESC
LIMIT 10;
```

## üõ†Ô∏è –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```python
from logger_config import log_user_action

@dp.message(CommandStart())
async def start(message: Message):
    log_user_action(
        logger, 
        message.from_user, 
        "–ö–æ–º–∞–Ω–¥–∞ /start", 
        "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
    )
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏

```python
from logger_config import log_error

try:
    # –í–∞—à –∫–æ–¥
    result = some_function()
except Exception as e:
    log_error(
        logger, 
        message.from_user, 
        e, 
        "–ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏"
    )
```

### –û–±—ã—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ")
logger.warning("–ù–∏–∑–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ API")
logger.error("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î", exc_info=True)
```

## üìä –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

### –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª –æ–± –æ—à–∏–±–∫–µ**
```bash
# –ù–∞—Ö–æ–¥–∏–º username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
grep "@username" logs/bot_all.log

# –°–º–æ—Ç—Ä–∏–º –µ–≥–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
tail -n 200 logs/bot_all.log | grep "user_id: 123456"
```

**2. –ë–æ—Ç –ø–µ—Ä–µ—Å—Ç–∞–ª –æ—Ç–≤–µ—á–∞—Ç—å**
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
grep "CRITICAL" logs/bot_errors.log

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–µ—Ä–µ–¥ –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π
tail -n 50 logs/bot_all.log
```

**3. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
```sql
-- –°–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —á–∞—Å
SELECT 
    DATE_TRUNC('hour', timestamp) as hour,
    COUNT(*) as requests
FROM bot_logs
WHERE message LIKE '%–ö–æ–º–∞–Ω–¥–∞%'
GROUP BY hour
ORDER BY hour DESC;
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ:**
- –õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç user_id –∏ username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ù–ï –ª–æ–≥–∏—Ä—É–π—Ç–µ –ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã –∏–ª–∏ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ—á–∏—â–∞–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –ë–î

## üßπ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤

### –§–∞–π–ª—ã
–†–æ—Ç–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—Ö—Ä–∞–Ω–∏—Ç—Å—è 10 —Ñ–∞–π–ª–æ–≤).

–î–ª—è —Ä—É—á–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏:
```bash
# –£–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
find logs/ -name "*.log*" -mtime +30 -delete
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```sql
-- –£–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏ —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π
DELETE FROM bot_logs 
WHERE timestamp < NOW() - INTERVAL '90 days';

-- –ò–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 000 –∑–∞–ø–∏—Å–µ–π
DELETE FROM bot_logs 
WHERE id NOT IN (
    SELECT id FROM bot_logs 
    ORDER BY timestamp DESC 
    LIMIT 100000
);
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

```bash
# –°–æ–∑–¥–∞—Ç—å cron –∑–∞–¥–∞—á—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—à–∏–±–æ–∫
# –ö–∞–∂–¥—ã–π —á–∞—Å –ø—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
0 * * * * grep "CRITICAL" /path/to/logs/bot_errors.log && echo "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞!" | mail -s "Alert" admin@example.com
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `logger_config.py`:

- –ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤: `maxBytes`
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ backup —Ñ–∞–π–ª–æ–≤: `backupCount`
- –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö handlers
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è logging](https://docs.python.org/3/library/logging.html)
- [–°—Ç–∞—Ç—å—è –Ω–∞ –•–∞–±—Ä–µ –æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏](https://habr.com/ru/companies/otus/articles/782646/)

---

**–ü–æ–º–Ω–∏—Ç–µ**: –•–æ—Ä–æ—à–∏–µ –ª–æ–≥–∏ - —ç—Ç–æ –ø–æ–ª–æ–≤–∏–Ω–∞ —É—Å–ø–µ—Ö–∞ –≤ –æ—Ç–ª–∞–¥–∫–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è! üöÄ

